<h1>Personal Orders</h1>
<% @purchases.each do |purchase| %>
  <div class="col-md-4">
    <%= "Total Price: #{number_to_currency(purchase.total_price, precision: 2)}" %><br>
    <%= "Shipping Option: #{purchase.shipping_option}" %><br>
    <%= "Ship To: #{purchase.ship_to}" %><br>
    <%= "Status: #{purchase.status}" %><br>
    <% if purchase.tracking_number %>
      <%= "Carrier: #{purchase.carrier}" %><br>
      <%= "Tracking Number: #{purchase.tracking_number}" %><br>
    <% end %>
    <h4>Products</h4>
    <% purchase.order_items.each do |p,g| %>        
      <ul class='col-md-6'>
        <li>Item: <%= p.title %></li>
        <li>Price: <%= number_to_currency(p.price, precision: 2) %></li>
        <li>Quantity: <%= p.quantity %></li>
      </ul>
    <% end %>
    <%= link_to "Submit Order #{number_to_currency(purchase.total_price, precision: 2)}", purchases_path(merchant_id: purchase.merchant_id, order: purchase), class: 'btn btn-success', method: :post, data: {confirm: "You Agree to the merchant #{User.find(purchase.merchant_id).username}'s Return Policy?"} %>
    <% if purchase.refunded? %>
      <h4>This Purchase Has Been Refunded</h4>
    <% elsif purchase.refunded && purchase.status != "Pending Submission"
       %>
      <%= link_to "Refund", refunds_path(purchase_id: purchase.purchase_id, price: purchase.total_price, application_fee: purchase.application_fee, refund_id: purchase.stripe_charge_id), method: :post, data: { confirm: "Refund now for #{number_to_currency(purchase.total_price.to_f / 100, precision: 2)}?" }, class: 'btn btn-danger' %><br>
    <% end %>
  </div>
<% end %>
<% if current_user.admin? || current_user.merchant? %>
  <h1>Store Orders</h1> 
  <% @orders.each do |order| %>
    <div class='col-md-4'>  
      <h4><%="Status: #{order.status}" %></h4><br>
      <%= "Tracking Number: #{order.tracking_number}" %><br>
      <%= "Shipping Address: #{order.ship_to}" %><br>
      <%= "Customer Contact: #{order.customer_name}" %><br>
      <%= "Shipping Option: #{order.shipping_option}" %><br>
      <%= "Shipping Price: #{number_to_currency(order.shipping_price, precision: 2)}" %><br>
      <%= "Total Price: #{number_to_currency(order.total_price, precision: 2)}" %><br>
      <%= "Paid: #{order.paid}" %><br>
      <h4>Product Information</h4>
      <% order.order_items.each do |oi| %>
        <ul class='col-md-6'>
          <li><%= oi.title %><br></li>
          <li><%= oi.quantity %><br></li>
          <li><%= number_to_currency(oi.price, precision:2) %></li><br>
        </ul>  
      <% end %>
    </div>
  <% end %>
<% end %>